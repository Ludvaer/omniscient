<% provide(:title, "Sign Up") %>

<div id="signUpResponse">
	<%= render 'form' %>
</div>

<script type="text/javascript">
	var rsa = forge.pki.rsa;	
    var responseDiv = document.getElementById("signUpResponse");
    var hashed =""
    function test() {
    	var pkeyInput = document.getElementById("publickey");
    	var publicKey = forge.pki.publicKeyFromPem(pkeyInput.value);
    	var signUpButton = document.getElementById("sign-up-button");
    	var saltInput = document.getElementById("salt");
    	var nameInput = document.getElementById("username");
		var passInput = document.getElementById("password");
    	

    	//var md = forge.md.sha512.create();
    	//md.update(passInput.value + '|' + nameInput.value);
    	//hashed = md.digest().toHex();

    	var hmac = forge.hmac.create();
    	hmac.start('sha256', saltInput.value);
    	hmac.update(passInput.value);
    	hashed = hmac.digest().toHex();
		var encrypted = forge.util.bytesToHex(publicKey.encrypt(hashed + '|' + saltInput.value));
    	encryptsignup(encrypted);
    }


</script>