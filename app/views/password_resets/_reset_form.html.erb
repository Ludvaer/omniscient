<% if @user.errors.any? %>
    <div id="error_explanation" class="error">
      <h3><%= pluralize(@user.errors.count, "error") %> happened:</h3>
      <ul>
      <% @user.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
<% end %>
<% form_params =  {url: reset_password_url} %>
<%= form_for(@user, form_params) do |f| %>
  <input type="text" style="display: none;" hidden="hidden" name="token" id = "password-reset-token" value="<%= @token %>"/>
  <% if @user.doublepost then %> <div class="error">Double same form submission detected.</div><%end%>
  <% if @user.decryption_failed then %> <div class="error">Decription failed, try again.</div><%end%>
  <% if @no_right then %> <div class="error">You have no rights to perform this action.</div><%end%>
  <%= user_salt_field %>
	<%= user_password_field(f,true) %>
  <%= user_password_confirmation_field(f) %>
	<%= f.submit id:'user-submit',  value:  (yield :action), :class => "btn"%>
<% end %>